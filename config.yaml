# FaceOff Configuration File
# This file contains all configurable settings for the application

# =============================================================================
# File Limits & Resource Constraints
# =============================================================================
limits:
  max_file_size_mb: 500           # Maximum upload file size in MB
  max_video_duration_sec: 300     # Maximum video duration in seconds (5 minutes)
  max_image_pixels: 16777216      # Maximum image resolution (4096 * 4096 = 4K)
  max_gif_frames: 500             # Maximum number of frames in GIF

# =============================================================================
# GPU & Performance Settings
# =============================================================================
gpu:
  # Frame batching for better GPU utilization
  batch_size: 4                   # Frames to process per batch (1-16)
  max_batch_size: 16              # Safety limit to prevent OOM
  
  # Multi-GPU settings (only for enhancement, not face swapping)
  workers_per_gpu: 4              # Worker threads per GPU
  
  # TensorRT optimization (auto-enabled for face detection)
  tensorrt_enabled: true          # Enable TensorRT optimization
  tensorrt_fp16: true             # Use FP16 precision (faster)
  tensorrt_workspace_mb: 2048     # Workspace size in MB

# =============================================================================
# Face Detection Settings
# =============================================================================
face_detection:
  # Model paths
  inswapper_model_path: "inswapper_128.onnx"
  buffalo_model_path: "models/buffalo_l"
  face_analysis_name: "buffalo_l"
  face_analysis_det_size: [640, 640]
  
  # Detection parameters
  confidence_threshold: 0.5       # Minimum confidence (0.0-1.0)
  
  # Resolution-adaptive detection (faster processing)
  adaptive_enabled: true          # Enable adaptive resolution
  detection_scale: 0.5            # Detect at fraction of original (0.25-1.0)
  min_resolution: 640             # Minimum resolution for detection

# =============================================================================
# Real-ESRGAN Enhancement Settings
# =============================================================================
enhancement:
  # Default model
  default_model: "RealESRGAN_x4plus"
  
  # Model options (Do not modify - these are system configurations)
  models:
    RealESRGAN_x4plus:
      display_name: "RealESRGAN_x4plus (General - Best for Photos)"
      supports_denoise: false
      description: "General purpose, best for photorealistic images"
    
    RealESRGAN_x4plus_anime_6B:
      display_name: "RealESRGAN_x4plus_anime_6B (Anime/Illustrations)"
      supports_denoise: false
      description: "Optimized for anime and illustrated content"
    
    RealESRNet_x4plus:
      display_name: "RealESRNet_x4plus (Conservative)"
      supports_denoise: false
      description: "More conservative, fewer artifacts"
    
    realesr-general-x4v3:
      display_name: "realesr-general-x4v3 (With Denoise)"
      supports_denoise: true
      description: "General model with adjustable denoising"
    
    realesr-animevideov3:
      display_name: "realesr-animevideov3 (Anime Video)"
      supports_denoise: false
      description: "Designed specifically for anime videos"
    
    RealESRGAN_x2plus:
      display_name: "RealESRGAN_x2plus (Fast 2x)"
      supports_denoise: false
      description: "Faster 2x upscaling"
  
  # Default enhancement parameters
  defaults:
    tile_size: 256                # Tile size (128-512, lower = less VRAM)
    outscale: 4                   # Upscaling factor (2 or 4)
    pre_pad: 0                    # Edge padding (0-20)
    use_fp32: false               # Use FP32 precision (more VRAM)
    denoise_strength: 0.5         # For models that support it (0.0-1.0)

# =============================================================================
# Face Restoration (GFPGAN) Settings
# =============================================================================
face_restoration:
  enabled_by_default: false       # Enable GFPGAN by default
  model_version: "1.3"            # GFPGAN model version
  default_weight: 0.5             # Restoration weight (0.0-1.0)

# =============================================================================
# Async Pipeline Settings
# =============================================================================
async_pipeline:
  enabled: true                   # Use async pipeline for videos/GIFs
  min_frames_threshold: 10        # Minimum frames to use async (below uses sync)

# =============================================================================
# Logging Configuration
# =============================================================================
logging:
  # File settings
  log_file: "app.log"
  max_file_size_mb: 10            # Maximum log file size before rotation
  backup_count: 5                 # Number of backup log files to keep
  
  # Log levels: DEBUG, INFO, WARNING, ERROR, CRITICAL
  console_level: "INFO"           # Console output level
  file_level: "DEBUG"             # File output level
  
  # Log format
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  date_format: "%Y-%m-%d %H:%M:%S"

# =============================================================================
# Model Caching Settings
# =============================================================================
model_cache:
  # TensorRT engine caching
  tensorrt_cache_dir: "cache/tensorrt"
  tensorrt_cache_enabled: true
  
  # Model preloading (load models at startup to avoid first-run delay)
  preload_on_startup: false       # Set to true to preload all models
  preload_models:
    - "buffalo_l"                 # Face detection model
    - "inswapper_128"             # Face swapping model
    # Enhancement models loaded on-demand due to size

# =============================================================================
# Memory Management
# =============================================================================
memory:
  # Automatic VRAM management
  auto_clear_cache: true          # Clear CUDA cache between processing stages
  clear_cache_threshold_mb: 1024  # Clear if free VRAM below this (MB)
  
  # Emergency fallback settings
  reduce_batch_on_oom: true       # Reduce batch size if OOM detected
  min_batch_size: 1               # Minimum batch size before failing

# =============================================================================
# Supported File Formats
# =============================================================================
file_formats:
  images:
    - ".jpg"
    - ".jpeg"
    - ".png"
    - ".bmp"
    - ".webp"
  
  videos:
    - ".mp4"
    - ".webp"
    - ".avi"
    - ".mov"
  
  gifs:
    - ".gif"

# =============================================================================
# Temporary Directories
# =============================================================================
directories:
  temp_gif_frames: "temp/gif/frames"
  temp_gif_enhanced: "temp/gif/enhanced"
  output: "outputs"
  models: "models"
  cache: "cache"

# =============================================================================
# UI Settings
# =============================================================================
ui:
  server_name: "127.0.0.1"
  server_port: 7860
  share: false                    # Create public Gradio link
  theme: "default"                # Gradio theme
